{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-kanban"></i> Fluxo de Produção</h2>
        
        {% if current_user.funcao in ['admin', 'vendas'] %}
        <a href="{{ url_for('novo_pedido') }}" class="btn btn-primary shadow">
            <i class="bi bi-cart-plus-fill"></i> Nova Venda / Orçamento
        </a>
        {% endif %}
    </div>

    <div class="row flex-nowrap overflow-auto pb-3">
        {% for setor in setores %}
        <div class="col-md-4" style="min-width: 350px;">
            <div class="card bg-light border-0 shadow-sm">
                <div class="card-header bg-dark text-white d-flex justify-content-between">
                    <span>{{ setor.nome }}</span>
                    <span class="badge bg-secondary">{{ setor.cards|length }}</span>
                </div>
                <div class="card-body p-2" style="min-height: 70vh;">
                    {% for card in setor.cards %}
                    <div class="card mb-2 shadow-sm border-start border-4" style="border-color: {{ card.status_ref.cor if card.status_ref else '#ccc' }} !important;">
                        <div class="card-body p-3">
                            <h6 class="card-title fw-bold mb-1">{{ card.titulo }}</h6>
                            <p class="small text-muted mb-2">
                                <i class="bi bi-person"></i> {{ card.cliente_ref.nome if card.cliente_ref else 'Sem cliente' }}
                            </p>
                            
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="badge bg-light text-dark border">
                                    <i class="bi bi-calendar-event"></i> {{ card.prazo }}
                                </span>
                                <span class="fw-bold text-primary">R$ {{ "%.2f"|format(card.valor_total) }}</span>
                            </div>

                            <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                                <small class="text-muted" style="font-size: 0.75rem;">ID: #{{ card.id }}</small>
                                
                                <a href="{{ url_for('print_orcamento', id=card.id) }}" target="_blank" class="btn btn-sm btn-light text-secondary border-0" title="Imprimir Orçamento / PDF">
                                    <i class="bi bi-printer-fill"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}