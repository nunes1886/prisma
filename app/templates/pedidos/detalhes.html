{% extends "base.html" %}

{% block content %}

<style>
    @media print {
        .sidebar, .btn-acao, .alert { display: none !important; }
        .content-area { padding: 0 !important; margin: 0 !important; }
        body { background: white; }
        .card { border: none !important; shadow: none !important; }
    }
    .papel-orcamento {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border: 1px solid #ddd;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
</style>

<div class="d-flex justify-content-between mb-4 btn-acao">
    <div class="d-flex gap-2">
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">‚¨Ö Voltar</a>
        
        {% if pedido.status == 'Orcamento' %}
            <a href="{{ url_for('pedidos.alterar_status', id=pedido.id, novo_status='Producao') }}" 
               class="btn btn-success">‚úÖ Aprovar (Produ√ß√£o)</a>
            
            <a href="{{ url_for('pedidos.alterar_status', id=pedido.id, novo_status='Cancelado') }}" 
               class="btn btn-outline-danger"
               onclick="return confirm('Cancelar este or√ßamento?')">‚ùå Cancelar</a>

        {% elif pedido.status == 'Producao' %}
            <a href="{{ url_for('pedidos.alterar_status', id=pedido.id, novo_status='Finalizado') }}" 
               class="btn btn-dark">üèÅ Finalizar / Entregar</a>
            
            <a href="{{ url_for('pedidos.alterar_status', id=pedido.id, novo_status='Orcamento') }}" 
               class="btn btn-outline-warning">‚Ü© Voltar para Or√ßamento</a>

        {% elif pedido.status == 'Finalizado' %}
            <button class="btn btn-success disabled">‚ú® Pedido Entregue</button>
            <a href="{{ url_for('pedidos.alterar_status', id=pedido.id, novo_status='Producao') }}" 
               class="btn btn-outline-secondary btn-sm">Reabrir</a>
        
        {% elif pedido.status == 'Cancelado' %}
            <button class="btn btn-danger disabled">üö´ Pedido Cancelado</button>
            <a href="{{ url_for('pedidos.alterar_status', id=pedido.id, novo_status='Orcamento') }}" 
               class="btn btn-outline-secondary btn-sm">Reabrir Or√ßamento</a>
        {% endif %}
    </div>

    <button onclick="window.print()" class="btn btn-primary">üñ®Ô∏è Imprimir / Salvar PDF</button>
</div>

<div class="papel-orcamento">
    <div class="row mb-5 border-bottom pb-3 align-items-center">
        <div class="col-8">
            {% if config_sistema.logo_filename %}
            <img src="{{ url_for('static', filename=config_sistema.logo_filename) }}" style="height: 60px;" class="mb-2">
            {% else %}
            <h2>{{ config_sistema.nome_empresa }}</h2>
            {% endif %}
            <div class="text-muted small">
                Data do Pedido: <strong>{{ pedido.data_criacao.strftime('%d/%m/%Y') }}</strong><br>
                Vendedor: {{ pedido.vendedor.nome_completo }}
            </div>
        </div>
        <div class="col-4 text-end">
            <h1 class="text-secondary">#{{ pedido.id }}</h1>
            
            {% if pedido.status == 'Orcamento' %}
                <span class="badge bg-warning text-dark fs-6">Or√ßamento</span>
            {% elif pedido.status == 'Producao' %}
                <span class="badge bg-primary fs-6">Em Produ√ß√£o</span>
            {% elif pedido.status == 'Finalizado' %}
                <span class="badge bg-success fs-6">Finalizado</span>
            {% else %}
                <span class="badge bg-danger fs-6">{{ pedido.status }}</span>
            {% endif %}
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <h5 class="text-uppercase text-muted small border-bottom mb-2">Cliente</h5>
            <h4>{{ pedido.cliente.nome }}</h4>
            <p class="mb-0">
                Doc: {{ pedido.cliente.documento or 'N√£o informado' }} <br>
                Tel: {{ pedido.cliente.telefone or 'N√£o informado' }}
            </p>
        </div>
    </div>

    <table class="table table-bordered mb-4">
        <thead class="table-light">
            <tr>
                <th>Descri√ß√£o / Material</th>
                <th class="text-center">Medidas</th>
                <th class="text-center">Qtd</th>
                <th class="text-end">Unit.</th>
                <th class="text-end">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in pedido.itens %}
            <tr>
                <td>
                    <strong>{{ item.material.nome }}</strong>
                    <br><small class="text-muted">{{ item.material.unidade }}</small>
                </td>
                <td class="text-center">
                    {% if item.material.unidade == 'm2' %}
                        {{ "%.2f"|format(item.largura) }}m x {{ "%.2f"|format(item.altura) }}m
                        <br><small class="text-muted">({{ "%.2f"|format(item.largura * item.altura) }} m¬≤)</small>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-center">{{ item.quantidade }}</td>
                <td class="text-end">R$ {{ "%.2f"|format(item.preco_unitario) }}</td>
                <td class="text-end fw-bold">R$ {{ "%.2f"|format(item.subtotal) }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr class="table-light">
                <td colspan="4" class="text-end fs-5"><strong>TOTAL A PAGAR:</strong></td>
                <td class="text-end fs-4 fw-bold text-dark">R$ {{ "%.2f"|format(pedido.valor_total) }}</td>
            </tr>
        </tfoot>
    </table>

    <div class="text-center mt-5 pt-4 border-top text-muted small">
        <p>Este or√ßamento tem validade de 10 dias.<br>
        Obrigado pela prefer√™ncia!</p>
    </div>
</div>
{% endblock %}  