{% extends "base.html" %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>üì¶ Tabela de Pre√ßos e Materiais</h2>
  <button
    class="btn btn-success"
    data-bs-toggle="modal"
    data-bs-target="#modalNovoMaterial"
  >
    + Novo Material
  </button>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <table class="table table-hover table-striped mb-0 align-middle">
      <thead class="table-dark">
        <tr>
          <th>Nome</th>
          <th>Unidade</th>
          <th>Custo</th>
          <th>Venda (Final)</th>
          <th>Revenda (Parceiro)</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        {% for item in itens %}
        <tr>
          <td><strong>{{ item.nome }}</strong></td>
          <td><span class="badge bg-secondary">{{ item.unidade }}</span></td>
          <td class="text-muted">R$ {{ "%.2f"|format(item.preco_custo) }}</td>
          <td class="text-primary fw-bold">
            R$ {{ "%.2f"|format(item.preco_venda) }}
          </td>
          <td class="text-success fw-bold">
            R$ {{ "%.2f"|format(item.preco_revenda) }}
          </td>
          <td>
            <button
              class="btn btn-sm btn-outline-primary me-1"
              data-bs-toggle="modal"
              data-bs-target="#modalEditar{{ item.id }}"
            >
              Editar
            </button>

            <a
              href="{{ url_for('materiais.deletar', id=item.id) }}"
              class="btn btn-sm btn-outline-danger"
              onclick="return confirm('Tem certeza que deseja excluir?');"
              >Excluir</a
            >
          </td>
        </tr>

        <div class="modal fade" id="modalEditar{{ item.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-light">
                <h5 class="modal-title">Editar: {{ item.nome }}</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>
              <form
                action="{{ url_for('materiais.editar', id=item.id) }}"
                method="POST"
              >
                <div class="modal-body">
                  <div class="mb-3">
                    <label>Nome do Material</label>
                    <input
                      type="text"
                      name="nome"
                      class="form-control"
                      value="{{ item.nome }}"
                      required
                    />
                  </div>

                  <div class="mb-3">
    <label>Unidade</label>
    <select name="unidade" class="form-select">
        <option value="m2" {{ 'selected' if item.unidade == 'm2' else '' }}>Metro Quadrado (m¬≤)</option>
        <option value="un" {{ 'selected' if item.unidade == 'un' else '' }}>Unidade (un)</option>
        <option value="ml" {{ 'selected' if item.unidade == 'ml' else '' }}>Metro Linear (ml)</option>
    </select>
</div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="fw-bold text-primary">Pre√ßo Venda</label>
                      <input
                        type="number"
                        step="0.01"
                        name="preco_venda"
                        class="form-control"
                        value="{{ item.preco_venda }}"
                        required
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="fw-bold text-success">Pre√ßo Revenda</label>
                      <input
                        type="number"
                        step="0.01"
                        name="preco_revenda"
                        class="form-control"
                        value="{{ item.preco_revenda }}"
                      />
                    </div>
                  </div>

                  <div class="mb-3">
                    <label>Pre√ßo de Custo</label>
                    <input
                      type="number"
                      step="0.01"
                      name="preco_custo"
                      class="form-control"
                      value="{{ item.preco_custo }}"
                    />
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Cancelar
                  </button>
                  <button type="submit" class="btn btn-primary">
                    Salvar Altera√ß√µes
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% else %}
        <tr>
          <td colspan="6" class="text-center py-4 text-muted">
            Nenhum material cadastrado.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="modal fade" id="modalNovoMaterial" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cadastrar Novo Material</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form action="{{ url_for('materiais.novo') }}" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label>Nome do Material</label>
            <input
              type="text"
              name="nome"
              class="form-control"
              placeholder="Ex: Lona 440g"
              required
            />
          </div>

          <div class="mb-3">
            <label>Unidade</label>
            <select name="unidade" class="form-select">
              <option value="m2">Metro Quadrado (m¬≤)</option>
              <option value="un">Unidade (un)</option>
              <option value="ml">Metro Linear (ml)</option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="fw-bold text-primary">Pre√ßo Venda (Final)</label>
              <input
                type="number"
                step="0.01"
                name="preco_venda"
                class="form-control"
                placeholder="0.00"
                required
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="fw-bold text-success">Pre√ßo Revenda</label>
              <input
                type="number"
                step="0.01"
                name="preco_revenda"
                class="form-control"
                placeholder="0.00"
              />
            </div>
          </div>

          <div class="mb-3">
            <label>Pre√ßo de Custo (Interno)</label>
            <input
              type="number"
              step="0.01"
              name="preco_custo"
              class="form-control"
              placeholder="0.00"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
